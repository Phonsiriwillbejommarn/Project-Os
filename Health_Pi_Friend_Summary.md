# ğŸ¥ Health Pi Friend - à¸ªà¸£à¸¸à¸›à¹‚à¸›à¸£à¹€à¸ˆà¸„à¸ªà¸³à¸«à¸£à¸±à¸šà¸™à¸³à¹€à¸ªà¸™à¸­

## ğŸ“‹ à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¸‚à¸­à¸‡à¹‚à¸›à¸£à¹€à¸ˆà¸„

**Health Pi Friend** à¸„à¸·à¸­ à¸£à¸°à¸šà¸šà¸œà¸¹à¹‰à¸Šà¹ˆà¸§à¸¢ AI à¸”à¹‰à¸²à¸™à¸ªà¸¸à¸‚à¸ à¸²à¸à¹à¸¥à¸°à¹‚à¸ à¸Šà¸™à¸²à¸à¸²à¸£ à¸—à¸µà¹ˆà¸£à¸±à¸™à¸šà¸™ **Raspberry Pi** à¹‚à¸”à¸¢à¸¡à¸µà¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ:

1. **à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¸°à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸­à¸²à¸«à¸²à¸£** - à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸–à¹ˆà¸²à¸¢à¸£à¸¹à¸›à¸­à¸²à¸«à¸²à¸£ â†’ AI à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹à¸„à¸¥à¸­à¸£à¸µà¹ˆ/à¸ªà¸²à¸£à¸­à¸²à¸«à¸²à¸£
2. **à¸•à¸´à¸”à¸•à¸²à¸¡à¸ªà¸¸à¸‚à¸ à¸²à¸** - à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Smart Watch à¸œà¹ˆà¸²à¸™ BLE â†’ à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ HR, Steps à¹à¸šà¸š real-time
3. **AI Coaching** - à¹ƒà¸«à¹‰à¸„à¸³à¹à¸™à¸°à¸™à¸³à¹à¸šà¸š personalized à¸•à¸²à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰
4. **Dashboard** - à¹à¸ªà¸”à¸‡à¸ à¸²à¸à¸£à¸§à¸¡à¸ªà¸¸à¸‚à¸ à¸²à¸à¹à¸šà¸š real-time

---

## ğŸ—ï¸ à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Smart Watch   â”‚â”€â”€â”€â”€â–¶â”‚  Raspberry Pi   â”‚â—€â”€â”€â”€â”€â”‚   Mobile/Web    â”‚
â”‚   (Aolon BLE)   â”‚     â”‚   (Backend)     â”‚     â”‚   (Frontend)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼            â–¼            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ SQLite   â”‚ â”‚ Gemini   â”‚ â”‚ Systemd  â”‚
              â”‚ Database â”‚ â”‚ AI API   â”‚ â”‚ Service  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ Linux/OS Commands à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹ƒà¸™à¹‚à¸›à¸£à¹€à¸ˆà¸„

### 1. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Services (systemd)

| à¸„à¸³à¸ªà¸±à¹ˆà¸‡ | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|--------|---------|
| `sudo systemctl start nutrifriend` | à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ service |
| `sudo systemctl stop nutrifriend` | à¸«à¸¢à¸¸à¸” service |
| `sudo systemctl restart nutrifriend` | à¸£à¸µà¸ªà¸•à¸²à¸£à¹Œà¸— service |
| `sudo systemctl status nutrifriend` | à¸”à¸¹à¸ªà¸–à¸²à¸™à¸° service |
| `sudo systemctl enable nutrifriend` | à¹€à¸›à¸´à¸” auto-start à¸•à¸­à¸™ boot |
| `journalctl -u nutrifriend -f` | à¸”à¸¹ log à¹à¸šà¸š real-time |

**à¹„à¸Ÿà¸¥à¹Œ Service:** `/etc/systemd/system/nutrifriend.service`
```ini
[Unit]
Description=NutriFriend AI Health Assistant
After=network.target bluetooth.target

[Service]
Type=simple
User=os
WorkingDirectory=/home/os/Project-Os3/Project-Os
ExecStart=/bin/bash -c 'source backend/.venv/bin/activate && ./start_pi.sh'
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
```

---

### 2. Crontab - à¸‡à¸²à¸™à¸•à¸±à¹‰à¸‡à¹€à¸§à¸¥à¸²à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´

```bash
# à¹€à¸›à¸´à¸” crontab editor
crontab -e

# à¸”à¸¹ crontab à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
crontab -l
```

**à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¸±à¹‰à¸‡à¹„à¸§à¹‰:**
```bash
# à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸²à¸¬à¸´à¸à¸²à¸—à¸¸à¸ 1 à¸™à¸²à¸—à¸µ
* * * * * /home/os/Project-Os3/Project-Os/backend/venv/bin/python3 /home/os/Project-Os3/Project-Os/backend/read_watch.py >> /home/os/health_data.log 2>&1
```

---

### 3. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Process

| à¸„à¸³à¸ªà¸±à¹ˆà¸‡ | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|--------|---------|
| `ps aux \| grep python` | à¸”à¸¹ Python process à¸—à¸µà¹ˆà¸£à¸±à¸™à¸­à¸¢à¸¹à¹ˆ |
| `kill -9 <PID>` | à¸«à¸¢à¸¸à¸” process |
| `nohup ./start_pi.sh &` | à¸£à¸±à¸™ background (à¹„à¸¡à¹ˆà¸«à¸¢à¸¸à¸”à¹€à¸¡à¸·à¹ˆà¸­à¸›à¸´à¸” terminal) |
| `htop` | à¸”à¸¹ resource usage à¹à¸šà¸š interactive |

---

### 4. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Bluetooth (BLE)

| à¸„à¸³à¸ªà¸±à¹ˆà¸‡ | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|--------|---------|
| `bluetoothctl` | à¹€à¸›à¸´à¸” Bluetooth control |
| `scan on` | à¹€à¸£à¸´à¹ˆà¸¡à¸ªà¹à¸à¸™à¸­à¸¸à¸›à¸à¸£à¸“à¹Œ |
| `devices` | à¹à¸ªà¸”à¸‡à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸—à¸µà¹ˆà¹€à¸ˆà¸­ |
| `connect <MAC>` | à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸­à¸¸à¸›à¸à¸£à¸“à¹Œ |
| `hciconfig` | à¸”à¸¹à¸ªà¸–à¸²à¸™à¸° Bluetooth adapter |

---

### 5. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Network

| à¸„à¸³à¸ªà¸±à¹ˆà¸‡ | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|--------|---------|
| `ip addr` | à¸”à¸¹ IP address |
| `curl http://localhost:8000/health` | à¸—à¸”à¸ªà¸­à¸š API |
| `ss -tulpn` | à¸”à¸¹ port à¸—à¸µà¹ˆà¹€à¸›à¸´à¸”à¸­à¸¢à¸¹à¹ˆ |
| `ping <host>` | à¸—à¸”à¸ªà¸­à¸š network connectivity |

---

### 6. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Files à¹à¸¥à¸° Logs

| à¸„à¸³à¸ªà¸±à¹ˆà¸‡ | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|--------|---------|
| `tail -f /home/os/health_data.log` | à¸”à¸¹ log à¹à¸šà¸š real-time |
| `tail -50 <file>` | à¸”à¸¹ 50 à¸šà¸£à¸£à¸—à¸±à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸” |
| `less <file>` | à¸­à¹ˆà¸²à¸™à¹„à¸Ÿà¸¥à¹Œà¹à¸šà¸š scroll à¹„à¸”à¹‰ |
| `cat <file>` | à¹à¸ªà¸”à¸‡à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸—à¸±à¹‰à¸‡à¹„à¸Ÿà¸¥à¹Œ |
| `grep "ERROR" <file>` | à¸„à¹‰à¸™à¸«à¸²à¸„à¸³à¹ƒà¸™ file |

---

### 7. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Database (SQLite)

```bash
# à¹€à¸›à¸´à¸” SQLite shell
sqlite3 /home/os/Project-Os3/Project-Os/nutrifriend.db

# à¸”à¸¹ tables
.tables

# à¸”à¸¹ schema
.schema user_profiles

# Query
SELECT * FROM user_profiles;

# à¹€à¸à¸´à¹ˆà¸¡ column (Migration)
ALTER TABLE user_profiles ADD COLUMN step_goal INTEGER DEFAULT 10000;

# Backup
cp nutrifriend.db nutrifriend_backup_$(date +%Y%m%d).db
```

---

### 8. Python Virtual Environment

```bash
# à¸ªà¸£à¹‰à¸²à¸‡ venv
python3 -m venv .venv

# Activate
source .venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Deactivate
deactivate
```

---

### 9. Git Version Control

| à¸„à¸³à¸ªà¸±à¹ˆà¸‡ | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ |
|--------|---------|
| `git pull origin issue-1` | à¸”à¸¶à¸‡à¹‚à¸„à¹‰à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸” |
| `git status` | à¸”à¸¹à¸ªà¸–à¸²à¸™à¸° |
| `git log -5` | à¸”à¸¹ 5 commits à¸¥à¹ˆà¸²à¸ªà¸¸à¸” |
| `git diff` | à¸”à¸¹à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡ |

---

## ğŸ“ à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œà¸ªà¸³à¸„à¸±à¸

```
Project-Os/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py              # FastAPI server à¸«à¸¥à¸±à¸ (API endpoints à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)
â”‚   â”œâ”€â”€ models.py            # SQLAlchemy models (Database schema)
â”‚   â”œâ”€â”€ schemas.py           # Pydantic schemas (API validation)
â”‚   â”œâ”€â”€ watch_service.py     # BLE connection à¸à¸±à¸š Smart Watch
â”‚   â”œâ”€â”€ health_ai_engine.py  # AI à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸ªà¸¸à¸‚à¸ à¸²à¸
â”‚   â”œâ”€â”€ read_watch.py        # Crontab script à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸²à¸¬à¸´à¸à¸²
â”‚   â””â”€â”€ nutrifriend.db       # SQLite Database
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ App.tsx              # Main React component
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ OverviewDashboard.tsx  # à¸«à¸™à¹‰à¸²à¸ à¸²à¸à¸£à¸§à¸¡
â”‚   â”‚   â”œâ”€â”€ HealthDashboard.tsx    # à¸«à¸™à¹‰à¸²à¸ªà¸¸à¸‚à¸ à¸²à¸
â”‚   â”‚   â”œâ”€â”€ ChatAssistant.tsx      # Chat à¸à¸±à¸š AI
â”‚   â”‚   â””â”€â”€ Onboarding.tsx         # à¸«à¸™à¹‰à¸²à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™
â”‚   â””â”€â”€ dist/                # Built production files
â”‚
â”œâ”€â”€ nutrifriend.service      # Systemd service file
â”œâ”€â”€ install_service.sh       # Script à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ service
â”œâ”€â”€ start_pi.sh              # Script à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ server
â””â”€â”€ backup_db.sh             # Script backup database
```

---

## ğŸ”„ à¸£à¸°à¸šà¸š Log Analytics (API Management)

### à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™:
1. **à¹‚à¸”à¸™ Rate Limit (429)** â†’ Parse `retryDelay` à¸ˆà¸²à¸ API
2. **à¸•à¸±à¹‰à¸‡ Cooldown** â†’ à¸«à¹‰à¸²à¸¡à¸¢à¸´à¸‡ model à¸™à¸µà¹‰à¸•à¸²à¸¡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆ API à¹à¸™à¸°à¸™à¸³
3. **Fallback** â†’ à¸¥à¸­à¸‡ model à¸­à¸·à¹ˆà¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
4. **à¸šà¸±à¸™à¸—à¸¶à¸ Log** â†’ à¹€à¸‚à¸µà¸¢à¸™à¸¥à¸‡ `/home/os/api_analytics.log`

### Fallback Chain:
```
gemini-2.0-flash â†’ gemini-3-flash-preview â†’ gemini-2.5-flash-lite â†’ gemini-2.5-flash â†’ gemma-3-27b-it
```

### à¸”à¸¹à¸ªà¸–à¸´à¸•à¸´:
```bash
# Log file
tail -f /home/os/api_analytics.log

# API endpoint
curl http://localhost:8000/api/stats
```

---

## ğŸ“Š Log Files à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”

| à¹„à¸Ÿà¸¥à¹Œ | à¹€à¸™à¸·à¹‰à¸­à¸«à¸² | à¸—à¸µà¹ˆà¸¡à¸² |
|------|---------|-------|
| `/home/os/health_data.log` | HR, Steps à¸ˆà¸²à¸à¸™à¸²à¸¬à¸´à¸à¸² | Crontab (à¸—à¸¸à¸ 1 à¸™à¸²à¸—à¸µ) |
| `/home/os/api_analytics.log` | Rate limit, Cooldown events | Auto (à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸à¸´à¸” event) |
| `journalctl -u nutrifriend` | Server logs | Systemd |

---

## ğŸš€ à¸„à¸³à¸ªà¸±à¹ˆà¸‡ Deploy à¸šà¸™ Pi

```bash
# 1. Pull code à¸¥à¹ˆà¸²à¸ªà¸¸à¸”
cd /home/os/Project-Os3/Project-Os
git pull origin issue-1

# 2. Backup database (à¸–à¹‰à¸²à¸¡à¸µ migration)
cp nutrifriend.db nutrifriend_backup_$(date +%Y%m%d).db

# 3. Run migration (à¸–à¹‰à¸²à¸¡à¸µ column à¹ƒà¸«à¸¡à¹ˆ)
sqlite3 nutrifriend.db "ALTER TABLE user_profiles ADD COLUMN step_goal INTEGER DEFAULT 10000;"

# 4. Restart service
sudo systemctl restart nutrifriend

# 5. à¸”à¸¹ log
journalctl -u nutrifriend -f
```

---

## ğŸ“Œ Features à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡à¸£à¸°à¸šà¸š

| Feature | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ | à¹ƒà¸Šà¹‰ Linux/OS à¸­à¸°à¹„à¸£ |
|---------|----------|-------------------|
| Auto-start on Boot | à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³à¸‡à¸²à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸›à¸´à¸” Pi | Systemd |
| BLE Watch Connection | à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸™à¸²à¸¬à¸´à¸à¸² Smart Watch | Bluetooth, bleak library |
| Periodic Data Save | à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸¸à¸ 1 à¸™à¸²à¸—à¸µ | Crontab |
| AI API Management | à¸ˆà¸±à¸”à¸à¸²à¸£ rate limit à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ | In-memory + File logging |
| Database | à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰, à¸­à¸²à¸«à¸²à¸£, à¸ªà¸¸à¸‚à¸ à¸²à¸ | SQLite |
| Web Server | API à¹à¸¥à¸° Frontend | FastAPI + React |
